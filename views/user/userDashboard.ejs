<% if (user) { %>
  <% if (user.role === "admin") { %>
    <%- include('../partials/adminHeader') %>
  <% } else if (user.role === "faculty") { %>
    <%- include('../partials/facultyHeader') %>
  <% } else if (user.role === "eventCoordinator") { %>
    <%- include('../partials/eventCoordinatorHeader') %>
  <% } else { %>
    <%- include('../partials/userHeader') %>
  <% } %>
<% } else { %>
  <%- include('../partials/userHeader') %>
<% } %>

<main class="ml-60 p-8 bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen">
  <div class="max-w-6xl mx-auto">

    <!-- Featured Events Carousel -->
    <% if (events.length > 0) { %>
      <h2 class="text-3xl font-extrabold text-gray-800 mb-6">Featured Events</h2>
      <div class="relative overflow-hidden">

        <!-- Carousel wrapper -->
        <div id="carousel" class="flex items-center gap-6 transition-transform duration-500 ease-in-out cursor-grab">
          <% events.forEach(event => { %>
            <a href="/user/event/<%= event._id %>" class="slide min-w-[220px] bg-white/90 backdrop-blur rounded-2xl shadow-xl border border-gray-200 p-4 hover:scale-105 transform transition duration-300">
              <% if (event.media && event.media.length > 0) { %>
                <img src="/uploads/<%= event.media[0] %>" alt="Event Thumbnail" class="rounded-xl mb-2 h-36 w-full object-cover">
              <% } %>
              <h3 class="text-lg font-semibold text-gray-800"><%= event.name %></h3>
              <p class="text-sm text-gray-500">ðŸ“… <%= event.date %> | ðŸ•’ <%= event.time %></p>
              <p class="text-sm text-gray-600">ðŸ’° â‚¹<%= event.regFee %></p>
            </a>
          <% }) %>
        </div>

        <!-- Arrows -->
        <button id="prevBtn" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow hover:bg-white transition">
          â—€
        </button>
        <button id="nextBtn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/70 p-2 rounded-full shadow hover:bg-white transition">
          â–¶
        </button>

        <!-- Dots -->
        <div id="dots" class="absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-2"></div>
      </div>
    <% } %>

    <!-- Upcoming Events -->
    <h2 class="text-3xl font-extrabold text-gray-800 mt-12 mb-6">Upcoming Events</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% events.forEach(event => { %>
        <a href="/user/event/<%= event._id %>" class="backdrop-blur-lg bg-white/90 rounded-xl shadow-lg border border-gray-200 p-6 hover:shadow-xl hover:scale-[1.02] transition duration-300 block">
          <% if (event.media && event.media.length > 0) { %>
            <img src="/uploads/<%= event.media[0] %>" alt="Event Thumbnail" class="rounded-lg mb-4 h-48 w-full object-cover">
          <% } %>
          <h3 class="text-xl font-semibold text-gray-800 mb-2"><%= event.name %></h3>
          <p class="text-sm text-gray-500">ðŸ“… <%= event.date %> | ðŸ•’ <%= event.time %></p>
          <p class="text-sm text-gray-600">ðŸ’° â‚¹<%= event.regFee %></p>
        </a>
      <% }) %>
    </div>

  </div>
</main>

<style>
  .slide { transform: scale(0.9); user-select: none; transition: transform 0.4s ease; }
  #dots span {
    width: 10px; height: 10px;
    background: #ccc; border-radius: 50%;
    display: inline-block; cursor: pointer;
  }
  #dots span.active { background: #333; }
</style>

<script>
const carousel = document.getElementById('carousel');
let slides = Array.from(carousel.children);
let center = Math.min(2, slides.length - 1); // handle small event count
let slideWidth = slides[0].offsetWidth + 24;

// Update carousel position
function updateCarousel() {
  slides.forEach((slide, i) => {
    const pos = i - center;
    slide.style.transform = (pos === 0) ? 'scale(1.1)' :
                            (Math.abs(pos) === 1) ? 'scale(0.95)' : 'scale(0.85)';
  });

  const offset = center * slideWidth - slideWidth * 2;
  carousel.style.transform = `translateX(${-offset}px)`;

  // update dots
  const dotsContainer = document.getElementById('dots');
  dotsContainer.innerHTML = '';
  slides.forEach((_, i) => {
    const dot = document.createElement('span');
    if(i === center) dot.classList.add('active');
    dot.addEventListener('click', () => { center = i; updateCarousel(); resetAutoSlide(); });
    dotsContainer.appendChild(dot);
  });
}

function moveNext() {
  center++;
  if(center >= slides.length - 2 && slides.length > 4) {
    carousel.appendChild(slides[0]);
    slides.push(slides.shift());
    center--;
  }
  updateCarousel();
}

function movePrev() {
  center--;
  if(center < 2 && slides.length > 4) {
    carousel.prepend(slides[slides.length-1]);
    slides.unshift(slides.pop());
    center++;
  }
  updateCarousel();
}

let autoSlide = setInterval(moveNext, 4000);

document.getElementById('nextBtn').addEventListener('click', () => { moveNext(); resetAutoSlide(); });
document.getElementById('prevBtn').addEventListener('click', () => { movePrev(); resetAutoSlide(); });

function resetAutoSlide() {
  clearInterval(autoSlide);
  autoSlide = setInterval(moveNext, 4000);
}

updateCarousel();
</script>
